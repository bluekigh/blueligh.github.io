<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>디지털 시간 관리 앱</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* 기본 스타일 및 스크롤 제거 */
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden; /* 페이지 스크롤 제거 */
        font-family: "Inter", sans-serif; /* Inter 폰트 사용 */
      }

      /* 컨테이너 - 좌우 패널 배치 */
      .container {
        display: flex;
        height: 100%;
      }

      /* 왼쪽 패널 - 디지털 시계 영역 (70%) */
      .left-panel {
        flex: 7; /* 전체 너비의 70% 차지 */
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #e0f2f7; /* 부드러운 배경색 */
        position: relative; /* 자식 요소의 absolute 위치 지정을 위해 */
      }

      /* 디지털 시계 스타일 */
      .digital-clock {
        font-size: 4rem; /* 큰 글씨 */
        font-weight: 800; /* 매우 굵게 */
        color: #3b82f6; /* 파란색 */
        text-align: center;
        padding: 1rem;
        background-color: #f8fafc;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      /* 오른쪽 패널 - 입력 및 표시 영역 (30%) */
      .right-panel {
        flex: 3; /* 전체 너비의 30% 차지 */
        background-color: #ffffff;
        display: flex;
        flex-direction: column; /* 세로 방향으로 요소 배치 */
        border-left: 1px solid #e2e8f0; /* 좌측 경계선 */
      }

      /* 오른쪽 패널 - 상단 표시 영역 (7/8) */
      .display-area {
        flex: 7; /* 전체 높이의 7/8 차지 */
        padding: 1rem;
        overflow-y: auto; /* 내용이 많아지면 스크롤 가능 */
        background-color: #f1f5f9;
        border-bottom: 1px solid #e2e8f0;
      }

      /* 오른쪽 패널 - 하단 입력 영역 (1/8) */
      .input-area {
        flex: 1; /* 전체 높이의 1/8 차지 */
        display: flex;
        padding: 1rem;
        gap: 1rem; /* 요소들 간의 간격 */
        align-items: center; /* 세로 중앙 정렬 */
        background-color: #ffffff;
      }

      /* 시간 입력 필드 */
      #time-input {
        flex: 7; /* 입력 영역 너비의 70% */
        padding: 0.75rem;
        border: 1px solid #cbd5e1;
        border-radius: 0.5rem; /* 둥근 모서리 */
        font-size: 1rem;
        outline: none;
      }

      /* 추가 버튼 */
      #add-button {
        flex: 3; /* 입력 영역 너비의 30% */
        padding: 0.75rem 1rem;
        background-color: #3b82f6;
        color: white;
        border: none;
        border-radius: 0.5rem; /* 둥근 모서리 */
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: background-color 0.2s ease;
      }

      #add-button:hover {
        background-color: #2563eb;
      }

      /* 시간 표시 박스 */
      .time-box {
        background-color: #dbeafe; /* 기본 배경색 */
        color: #1e40af;
        padding: 0.75rem 1rem;
        margin-bottom: 0.75rem;
        border-radius: 0.5rem;
        font-size: 1.125rem; /* 18px */
        font-weight: 600;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        display: flex; /* Flexbox를 사용하여 내부 요소 정렬 */
        align-items: center; /* 세로 중앙 정렬 */
        justify-content: space-between; /* 요소들 간의 공간 분배 */
        cursor: pointer; /* 클릭 가능함을 나타내는 커서 */
        transition: background-color 0.2s ease;
      }

      /* 5분 미만으로 남은 시간 박스 스타일 */
      .time-box.urgent {
        background-color: #fce7f3; /* 연분홍빛 배경색 */
        color: #be185d; /* 더 진한 텍스트 색상 */
      }

      .time-box:hover {
        background-color: #bfdbfe; /* 호버 시 배경색 변경 */
      }
      .time-box.urgent:hover {
        background-color: #fbcfe8; /* 긴급 박스 호버 시 배경색 변경 */
      }

      .time-box .time-display {
        flex-grow: 1; /* 시간 텍스트가 가능한 공간을 모두 차지하도록 */
        text-align: left;
        font-size: 1.25rem; /* 메인 시간 글씨 크기 */
      }

      /* 남은 시간 텍스트 (하나만 사용) */
      .time-box .time-diff {
        flex-shrink: 0; /* 축소되지 않도록 */
        font-size: 0.875rem; /* 작은 글씨 */
        color: #4b5563;
        text-align: right;
        min-width: 100px; /* 최소 너비 설정으로 정렬 유지 */
      }

      /* 현재 시간 구분선 */
      .current-time-separator {
        text-align: center;
        font-weight: bold;
        color: #3b82f6;
        margin: 1rem 0;
        padding: 0.5rem 0;
        border-top: 1px dashed #93c5fd;
        border-bottom: 1px dashed #93c5fd;
        background-color: #eff6ff;
        border-radius: 0.25rem;
      }

      /* 정시 알람 버튼 스타일 (추가) */
      #on-the-hour-alarm-button {
        position: absolute;
        bottom: 1rem; /* 하단 마진 */
        right: 1rem; /* 우측 마진 */
        padding: 0.75rem 1rem;
        background-color: #10b981; /* 녹색 계열 */
        color: white;
        border: none;
        border-radius: 0.5rem; /* 둥근 모서리 */
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: background-color 0.2s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      #on-the-hour-alarm-button:hover {
        background-color: #059669;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="left-panel">
        <div class="digital-clock">00:00:00</div>
        <!-- S2: 정시 알람 버튼 추가 -->
        <button id="on-the-hour-alarm-button" class="rounded-lg shadow-md">
          정시 알람
        </button>
      </div>
      <div class="right-panel">
        <div class="display-area">
          <!-- 입력된 시간 박스들이 여기에 추가됩니다. -->
        </div>
        <div class="input-area">
          <input type="time" id="time-input" class="rounded-lg shadow-sm" />
          <button id="add-button" class="rounded-lg shadow-md">추가</button>
        </div>
      </div>
    </div>

    <script>
      // DOM 요소 가져오기
      const digitalClock = document.querySelector(".digital-clock");
      const addButton = document.getElementById("add-button");
      const timeInput = document.getElementById("time-input");
      const displayArea = document.querySelector(".display-area");
      const onTheHourAlarmButton = document.getElementById(
        "on-the-hour-alarm-button"
      ); // S2 버튼

      // 저장된 시간 목록 (문자열 배열)
      let scheduledTimes = [];

      // 디지털 시계 업데이트 함수
      function updateDigitalClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const seconds = String(now.getSeconds()).padStart(2, "0");
        digitalClock.textContent = `${hours}:${minutes}:${seconds}`;
      }

      // 두 시간 문자열 간의 가장 짧은 시간 차이를 밀리초 단위로 계산 (양수: 미래, 음수: 과거)
      function getShortestTimeDifferenceInMilliseconds(targetTimeStr, now) {
        const [targetHour, targetMinute] = targetTimeStr.split(":").map(Number);

        // 오늘, 내일, 어제 날짜의 목표 시간 Date 객체 생성
        const targetToday = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          targetHour,
          targetMinute,
          0
        );
        const targetTomorrow = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate() + 1,
          targetHour,
          targetMinute,
          0
        );
        const targetYesterday = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate() - 1,
          targetHour,
          targetMinute,
          0
        );

        // 현재 시간과의 차이 계산 (밀리초)
        const diffToday = targetToday.getTime() - now.getTime();
        const diffTomorrow = targetTomorrow.getTime() - now.getTime();
        const diffYesterday = targetYesterday.getTime() - now.getTime();

        // 가장 작은 절대값을 가진 차이 선택
        let shortestDiff = diffToday;
        if (Math.abs(diffTomorrow) < Math.abs(shortestDiff)) {
          shortestDiff = diffTomorrow;
        }
        if (Math.abs(diffYesterday) < Math.abs(shortestDiff)) {
          shortestDiff = diffYesterday;
        }

        return shortestDiff;
      }

      // 밀리초 단위 시간 차이를 "X시간 Y분 Z초 전/후" 형식으로 포맷
      function formatTimeDifference(diffMs) {
        const absDiffMs = Math.abs(diffMs);
        const totalSeconds = Math.floor(absDiffMs / 1000);
        const totalMinutes = Math.floor(totalSeconds / 60);
        const hours = Math.floor(totalMinutes / 60);
        const minutes = Math.floor(totalMinutes % 60);
        const seconds = Math.floor(totalSeconds % 60);

        let diffText = "";

        // 5분 미만일 경우 초까지 표시
        if (totalMinutes < 5) {
          if (hours > 0) {
            diffText += `${hours}시간 `;
          }
          if (minutes > 0 || hours > 0) {
            // 시간이 있거나 분이 0이 아니면 분 표시
            diffText += `${minutes}분 `;
          }
          diffText += `${seconds}초`;
        } else {
          // 5분 이상일 경우 시/분만 표시
          if (hours > 0) {
            diffText += `${hours}시간 `;
          }
          diffText += `${minutes}분`;
        }

        if (diffMs < 0) {
          return `${diffText} 전`;
        } else if (diffMs > 0) {
          return `${diffText} 후`;
        } else {
          return "지금";
        }
      }

      // 표시 영역 업데이트 및 시간 정렬 함수
      function updateDisplayArea() {
        const now = new Date();
        displayArea.innerHTML = ""; // 기존 내용 지우기

        const pastTimes = [];
        const futureTimes = [];

        // 입력된 시간들을 과거/미래로 분류하고 차이 계산
        scheduledTimes.forEach((timeStr) => {
          const diff = getShortestTimeDifferenceInMilliseconds(timeStr, now);
          if (diff <= 0) {
            // 0ms 포함하여 과거로 분류 (정렬 시 '지금'이 가장 가까운 과거로 처리됨)
            pastTimes.push({ time: timeStr, diff: diff });
          } else {
            futureTimes.push({ time: timeStr, diff: diff });
          }
        });

        // 과거 시간 정렬: 현재 시간에서 가까운 순서 (절대값 오름차순)
        pastTimes.sort((a, b) => Math.abs(a.diff) - Math.abs(b.diff));
        // 미래 시간 정렬: 현재 시간에서 가까운 순서 (오름차순)
        futureTimes.sort((a, b) => a.diff - b.diff);

        // 과거 시간들을 먼저 렌더링
        pastTimes.forEach((item) => {
          const timeBox = document.createElement("div");
          timeBox.classList.add("time-box");
          timeBox.setAttribute("data-time", item.time); // 삭제를 위해 원본 시간 저장
          const formattedDiff = formatTimeDifference(item.diff);

          // S1: 5분 미만일 경우 urgent 클래스 추가
          if (Math.abs(item.diff) / (1000 * 60) <= 5 && item.diff <= 0) {
            // 과거 시간 중 5분 이내
            timeBox.classList.add("urgent");
          }

          timeBox.innerHTML = `
                    <span class="time-display">${item.time}</span>
                    <span class="time-diff">${formattedDiff}</span>
                `;
          displayArea.appendChild(timeBox);
        });

        // 현재 시간 구분선 추가
        const currentTimeSeparator = document.createElement("div");
        currentTimeSeparator.classList.add("current-time-separator");
        currentTimeSeparator.textContent = "--- 현재 시간 ---";
        displayArea.appendChild(currentTimeSeparator);

        // 미래 시간들을 렌더링
        futureTimes.forEach((item) => {
          const timeBox = document.createElement("div");
          timeBox.classList.add("time-box");
          timeBox.setAttribute("data-time", item.time); // 삭제를 위해 원본 시간 저장
          const formattedDiff = formatTimeDifference(item.diff);

          // S1: 5분 미만일 경우 urgent 클래스 추가
          if (Math.abs(item.diff) / (1000 * 60) <= 5 && item.diff >= 0) {
            // 미래 시간 중 5분 이내
            timeBox.classList.add("urgent");
          }

          timeBox.innerHTML = `
                    <span class="time-display">${item.time}</span>
                    <span class="time-diff">${formattedDiff}</span>
                `;
          displayArea.appendChild(timeBox);
        });

        // 모든 time-box에 클릭 이벤트 리스너 추가 (삭제 기능)
        document.querySelectorAll(".time-box").forEach((box) => {
          box.addEventListener("click", (event) => {
            const timeToDelete = event.currentTarget.getAttribute("data-time");
            scheduledTimes = scheduledTimes.filter(
              (time) => time !== timeToDelete
            );
            updateDisplayArea(); // 삭제 후 목록 다시 그리기
          });
        });
      }

      // 페이지 로드 시 초기화 및 업데이트 시작
      window.onload = function () {
        updateDigitalClock(); // 초기 디지털 시계 설정
        // 1초마다 디지털 시계 업데이트 및 표시 영역 업데이트
        setInterval(() => {
          updateDigitalClock();
          updateDisplayArea();
        }, 1000);
      };

      // '추가' 버튼 클릭 이벤트 리스너
      addButton.addEventListener("click", () => {
        const selectedTime = timeInput.value; // "HH:MM" 형식의 문자열
        if (!selectedTime) {
          // 커스텀 메시지 박스 사용
          const messageBox = document.createElement("div");
          messageBox.textContent = "시간을 입력해주세요.";
          messageBox.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background-color: #fee2e2; color: #dc2626; padding: 1rem 2rem;
                    border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000;
                    font-weight: bold;
                `;
          document.body.appendChild(messageBox);
          setTimeout(() => messageBox.remove(), 2000); // 2초 후 메시지 제거
          return;
        }

        // 중복 시간 방지 (선택 사항)
        if (!scheduledTimes.includes(selectedTime)) {
          scheduledTimes.push(selectedTime);
          updateDisplayArea(); // 새로운 시간 추가 후 표시 영역 업데이트
        } else {
          const messageBox = document.createElement("div");
          messageBox.textContent = "이미 추가된 시간입니다.";
          messageBox.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background-color: #fff3cd; color: #856404; padding: 1rem 2rem;
                    border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000;
                    font-weight: bold;
                `;
          document.body.appendChild(messageBox);
          setTimeout(() => messageBox.remove(), 2000); // 2초 후 메시지 제거
        }

        timeInput.value = ""; // 입력 필드 초기화
      });

      // 시간 입력창에서 Enter 키 입력 시 버튼 클릭 이벤트 발생
      timeInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          event.preventDefault(); // 기본 Enter 동작(폼 제출 등) 방지
          addButton.click(); // '추가' 버튼 클릭 이벤트 발생
        }
      });

      // S2: 정시 알람 버튼 클릭 이벤트 리스너
      onTheHourAlarmButton.addEventListener("click", () => {
        const now = new Date();
        let currentHour = now.getHours();
        let nextAlarmHour = currentHour;

        // 현재 분 또는 초가 0이 아니면 다음 정각부터 시작
        if (now.getMinutes() > 0 || now.getSeconds() > 0) {
          nextAlarmHour++;
        }

        let foundNextAvailableTime = false;
        // 24시간 동안 다음 정각을 순회하며 찾기
        for (let i = 0; i < 24; i++) {
          let candidateHour = (nextAlarmHour + i) % 24;
          const candidateTime = `${String(candidateHour).padStart(2, "0")}:00`;

          if (!scheduledTimes.includes(candidateTime)) {
            scheduledTimes.push(candidateTime);
            updateDisplayArea(); // 새로운 시간 추가 후 표시 영역 업데이트
            foundNextAvailableTime = true;
            break; // 찾았으면 반복 중단
          }
        }

        if (!foundNextAvailableTime) {
          // 24시간 모두 등록되어 있다면 알림
          const messageBox = document.createElement("div");
          messageBox.textContent = "모든 정각 시간이 이미 추가되었습니다.";
          messageBox.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background-color: #fee2e2; color: #dc2626; padding: 1rem 2rem;
                    border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000;
                    font-weight: bold;
                `;
          document.body.appendChild(messageBox);
          setTimeout(() => messageBox.remove(), 2000); // 2초 후 메시지 제거
        }
      });
    </script>
  </body>
</html>
